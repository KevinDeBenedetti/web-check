# Docker Compose pour dÃ©veloppement local
# Utilise les volumes pour le hot-reload

services:
  web-dev:
    image: oven/bun:1.1-alpine
    container_name: vigil-web-dev
    working_dir: /app
    ports:
      - "3000:3000"
    volumes:
      - ./web:/app
      - /app/node_modules
    command: sh -c "bun install && bun run dev -- --host"
    environment:
      - VITE_API_URL=http://api:8000
    networks:
      - scanner-net
    depends_on:
      - api

  api:
    build: .
    container_name: vigil-api
    ports:
      - "8000:8000"
    volumes:
      - ./api:/app/api:ro
      - ./outputs:/app/outputs:rw
      - ./config:/app/config:ro
      - ./vigil.db:/app/vigil.db:rw
      - ./alembic:/app/alembic:ro
      - ./alembic.ini:/app/alembic.ini:ro
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - DEBUG=true
      - LOG_LEVEL=DEBUG
    networks:
      - scanner-net
    restart: unless-stopped
    depends_on:
      - zap
      - nuclei
      - nikto

  zap:
    image: zaproxy/zap-stable:latest
    container_name: security-scanner-zap
    volumes:
      - ./outputs:/zap/wrk:rw
    command: >
      zap.sh -daemon -host 0.0.0.0 -port 8090
      -config api.disablekey=true
      -config api.addrs.addr.name=.*
      -config api.addrs.addr.regex=true
    ports:
      - "8090:8090"
    networks:
      - scanner-net
    restart: unless-stopped

  nuclei:
    image: projectdiscovery/nuclei:latest
    container_name: security-scanner-nuclei
    volumes:
      - ./outputs:/output:rw
      - nuclei-templates:/root/nuclei-templates
    entrypoint: ["/bin/sh", "-c"]
    command: ["tail -f /dev/null"]
    networks:
      - scanner-net
    restart: unless-stopped

  nikto:
    image: alpine/nikto:latest
    container_name: security-scanner-nikto
    volumes:
      - ./outputs:/output:rw
    entrypoint: ["/bin/sh", "-c"]
    command: ["tail -f /dev/null"]
    networks:
      - scanner-net
    restart: unless-stopped

volumes:
  nuclei-templates:
    driver: local

networks:
  scanner-net:
    driver: bridge
